---
import BaseLayout from '../layouts/BaseLayout.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';
import { getCollection } from 'astro:content';
import { siteConfig } from '../config';

// Get books and paintings
const allBooks = await getCollection('books');

// Custom sort order
const prioritySlugs = ['born-crazy', 'the-witnesses-project', 'ecstasy', 'illumination'];

const sortedBooks = allBooks.sort((a, b) => {
  const indexA = prioritySlugs.indexOf(a.data.slug);
  const indexB = prioritySlugs.indexOf(b.data.slug);

  if (indexA !== -1 && indexB !== -1) return indexA - indexB;
  if (indexA !== -1) return -1;
  if (indexB !== -1) return 1;

  return a.data.order - b.data.order;
});

const featuredBook = sortedBooks.find(book => book.data.featured);

const allPaintings = await getCollection('paintings');
const featuredPainting = allPaintings[0]; // Just show first painting as preview
// Book background colors now loaded from content/books/*.json
---

<BaseLayout>
  <Nav />
  
  <main>
    <!-- Hero Section -->
    <section class="hero">
      <div class="hero-image">
        <img 
          src="/images/hero/bonnie-hero-alt.webp" 
          alt="Bonnie Bostrom" 
          loading="eager"
        />
      </div>
      <div class="hero-content container">
        <h1>Bonnie Bostrom</h1>
        <p class="hero-intro">
          Bonnie has been writing poetry and creating art since she was a little girl. Her published works include poetry collections, fine art criticism and memoir and have been published in several literary journals. Recently, she felt inspired to explore painting. She found that the ephemeral, celestial nature of her written work translated well into the visual medium.
        </p>
        <div class="hero-buttons">
          <a href="/books" class="btn btn-primary">Explore Books</a>
          <a href="/paintings" class="btn btn-secondary">Explore Paintings</a>
        </div>
      </div>
    </section>

    <!-- Books Section -->
    <section class="section books-section">
      <div class="container">
        <h2 class="section-title">Books By Bonnie</h2>
        <div class="grid grid-3">
          {sortedBooks.map((book) => (
            <a href={`/books#${book.data.slug}`} class="card-link">
              <div class="card">
                <img 
                  src={book.data.coverImage} 
                  alt={book.data.title}
                  class="card-image"
                  style={`background-color: ${book.data.color || '#f4f4f4'}`}
                  loading="lazy"
                />
                <div class="card-content">
                  <h3 class="card-title">{book.data.title}</h3>
                  <p>{book.data.blurb}</p>
                </div>
              </div>
            </a>
          ))}
        </div>
      </div>
    </section>

    <!-- Featured: Born Crazy -->
    {featuredBook && (
      <section class="section featured-section">
        <div class="container">
          <div class="featured-content">
            <div class="featured-image">
              <img 
                src={featuredBook.data.coverImage} 
                alt={featuredBook.data.title}
                loading="lazy"
              />
            </div>
            <div class="featured-text">
              <h2>Featured Memoir</h2>
              <h3>{featuredBook.data.title}</h3>
              <p>{featuredBook.data.description}</p>
              {featuredBook.data.buyUrl && (
                <button 
                  class="btn btn-primary add-to-cart-btn"
                  data-id={featuredBook.data.slug}
                >
                  Add to Cart - $25
                </button>
              )}
            </div>
          </div>
        </div>
      </section>
    )}

    <!-- Featured: Illumination -->
    <section class="section featured-section-alt">
      <div class="container">
        <div class="featured-content">
          <div class="featured-image">
            <img 
              src="/images/books/illumination.jpg" 
              alt="Illumination: 3 Sci-Fi Romances"
              loading="lazy"
            />
          </div>
          <div class="featured-text">
            <h2>Bonnie's Latest</h2>
            <h3>Illumination: 3 Sci-Fi Romances</h3>
            <p>A woman meets her soulmate when an alien ship crash-lands on her ranch.</p>
            <p>A dying mother recalls an encounter with a loving visitor from the stars.</p>
            <p>In a future world where Sensory Collectors buy and sell emotion-enhancing hormones, true love can be difficult to recognize.</p>
            <p>These are the settings for Bonnie Bostrom's brand of Science Fiction. Make that Romantic Science Fiction. Here, in "Illumination," the gentle touch speaks volumes when messages are transferred through thought; the understated life-long friendship with a mysterious red dot of light becomes a promise of hope in the beyond; and love ice skates across time, space, and realities to bring a couple together.</p>
            <p>The author welcomes the reader through the front door and into these short stories with a warm hand and a smile. There is no need for over-explanation or obvious, didactic metaphor. Less is more, and one of Ms. Bostrom's gifts as an author is to create believable characters and settings seemingly effortlessly and with finesse.</p>
            <p>In the story "Skuller," the heroine, Flyn, is described as a green-eyed woman with blue-black hair who is a natural empath. Her adventures take us into the realm of the speculative yet-to-be, but her character remains timeless—</p>
            <p><em>"Flyn was grateful to her parents for her beauty, but she was more brain than beauty-proud. Beauty was, at best, static, and after a certain age, a regressive process, whereas thinking was progressive, expansive, and dynamic."</em></p>
            <p>When my 14-year-old daughter read these Sci-fi tales of romance on a day off from school, she could be heard quietly sighing and laughing to herself on the sofa. When she finished, I asked for her thoughts. She gave a short, complimentary response that is, as parents of teens will know, the pinnacle of respect—</p>
            <p><em>"They're really cool," she said.</em></p>
            <p>I have to agree.</p>
            <p><strong>—Henry Long</strong></p>
            <a 
              href="https://buy.stripe.com/test_placeholder" 
              class="btn btn-primary"
              target="_blank"
              rel="noopener noreferrer"
            >
              Buy Now for $15
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Featured: Illumination -->
    <section class="section featured-section-alt">
      <div class="container">
        <div class="featured-content">
          <div class="featured-image">
            <img 
              src="/images/books/illumination.jpg" 
              alt="Illumination: 3 Sci-Fi Romances"
              loading="lazy"
            />
          </div>
          <div class="featured-text">
            <h2>Bonnie's Latest</h2>
            <h3>Illumination: 3 Sci-Fi Romances</h3>
            <p>A woman meets her soulmate when an alien ship crash-lands on her ranch.</p>
            <p>A dying mother recalls an encounter with a loving visitor from the stars.</p>
            <p>In a future world where Sensory Collectors buy and sell emotion-enhancing hormones, true love can be difficult to recognize.</p>
            <p>These are the settings for Bonnie Bostrom's brand of Science Fiction. Make that Romantic Science Fiction. Here, in "Illumination," the gentle touch speaks volumes when messages are transferred through thought; the understated life-long friendship with a mysterious red dot of light becomes a promise of hope in the beyond; and love ice skates across time, space, and realities to bring a couple together.</p>
            <p>The author welcomes the reader through the front door and into these short stories with a warm hand and a smile. There is no need for over-explanation or obvious, didactic metaphor. Less is more, and one of Ms. Bostrom's gifts as an author is to create believable characters and settings seemingly effortlessly and with finesse.</p>
            <p>In the story "Skuller," the heroine, Flyn, is described as a green-eyed woman with blue-black hair who is a natural empath. Her adventures take us into the realm of the speculative yet-to-be, but her character remains timeless—</p>
            <p><em>"Flyn was grateful to her parents for her beauty, but she was more brain than beauty-proud. Beauty was, at best, static, and after a certain age, a regressive process, whereas thinking was progressive, expansive, and dynamic."</em></p>
            <p>When my 14-year-old daughter read these Sci-fi tales of romance on a day off from school, she could be heard quietly sighing and laughing to herself on the sofa. When she finished, I asked for her thoughts. She gave a short, complimentary response that is, as parents of teens will know, the pinnacle of respect—</p>
            <p><em>"They're really cool," she said.</em></p>
            <p>I have to agree.</p>
            <p><strong>—Henry Long</strong></p>
            <button 
              class="btn btn-primary add-to-cart-btn"
              data-id="illumination"
            >
              Add to Cart - $15
            </button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</BaseLayout>

<script>
  import { cart } from '../lib/cart';
  
  const buttons = document.querySelectorAll('.add-to-cart-btn');
  buttons.forEach(btn => {
    btn.addEventListener('click', (e) => {
      // @ts-ignore
      const id = e.currentTarget.dataset.id;
      if (id) {
        cart.addToCart(id);
        window.dispatchEvent(new CustomEvent('cart:toggle'));
      }
    });
  });
</script>

<style>
  .hero {
    position: relative;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    text-align: center;
    margin-bottom: 0;
  }
  
  .hero-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
  }
  
  .hero-image::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.2);
    z-index: 1;
  }
  
  .hero-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter: brightness(0.6) blur(2px);
  }
  
  .hero-content {
    padding: 4rem 1.5rem;
  }
  
  .hero h1 {
    font-size: clamp(3rem, 6vw, 5rem);
    margin-bottom: 1rem;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
  }
  
  .hero-intro {
    font-size: clamp(1.25rem, 2.5vw, 1.5rem);
    max-width: 800px;
    margin: 0 auto 2rem;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
  }
  
  .hero-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
  }
  
  .featured-section {
    background-color: #f9f9f9;
  }
  
  .featured-section-alt {
    background-color: #fff;
    padding: 4rem 0;
  }
  
  .featured-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
    align-items: center;
  }
  
  .featured-image img {
    width: 100%;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }
  
  .featured-text h2 {
    color: #662b5c;
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
  }
  
  .featured-text h3 {
    font-size: 2.5rem;
    margin-bottom: 1.5rem;
  }
  
  .featured-text p {
    margin-bottom: 1rem;
    line-height: 1.8;
  }
  
  .featured-text p:last-of-type {
    margin-bottom: 2rem;
  }
  
  .contact-section {
    background-color: #f5f5f5;
  }
  
  .contact-title {
    font-size: 1.75rem;
    max-width: 900px;
    margin: 0 auto 3rem;
    line-height: 1.6;
  }
  
  .contact-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
    align-items: start;
  }
  
  .contact-image img {
    width: 100%;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .card-link {
    display: block;
    text-decoration: none;
    color: inherit;
    height: 100%;
  }
  
  .card-link:hover {
    text-decoration: none;
    color: inherit;
  }
  
  .card {
    height: 100%; /* Ensure card takes full height of link anchor */
  }
  
  .featured-section-alt .featured-content {
    align-items: start;
  }
  
  @media (max-width: 768px) {
    .featured-content {
      grid-template-columns: 1fr;
    }
    
    .contact-grid {
      grid-template-columns: 1fr;
    }
    
    .hero {
      min-height: 100vh;
    }
    
    .hero-buttons {
      flex-direction: column;
      align-items: center;
    }
    
    .hero-buttons .btn {
      width: 100%;
      max-width: 300px;
    }
  }
</style>
